# TP-003 : API CRUD Complet avec Flask

## Objectif du TP
L'objectif de ce travail pratique est de concevoir une API REST complète en utilisant Flask. Cette API permettra d'effectuer des opérations CRUD (Créer, Lire, Mettre à jour, Supprimer) sur une ressource.

## Prérequis
- Python 3.x
- Flask installé (`pip install Flask`)

## Étapes à suivre

### 1. Configuration de l'environnement
   Commencez par créer un nouveau dossier pour votre projet et installez Flask si ce n'est pas déjà fait.

### 2. Création de la structure du projet
   Dans votre dossier de projet, créez les fichiers suivants :
   - `app.py` : le fichier principal de l'application
   - `model.py` : pour la définition des modèles de données

### 3. Définir le modèle de données
   Dans `model.py`, vous pouvez définir un modèle simple. Par exemple, un modèle `Item` :
   ```python
   from flask_sqlalchemy import SQLAlchemy

   db = SQLAlchemy()

   class Item(db.Model):
       id = db.Column(db.Integer, primary_key=True)
       name = db.Column(db.String(100), nullable=False)
       description = db.Column(db.String(200), nullable=True)
   ```

### 4. Initialiser l'application Flask
   Dans `app.py`, commencez à construire votre application Flask :
   ```python
   from flask import Flask, jsonify, request
   from model import db, Item

   app = Flask(__name__)
   app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///items.db'
   db.init_app(app)

   with app.app_context():
       db.create_all()
   ```

### 5. Implémentation des routes CRUD
   - **Créer un élément** :
     ```python
     @app.route('/items', methods=['POST'])
     def create_item():
         data = request.get_json()
         new_item = Item(name=data['name'], description=data.get('description'))
         db.session.add(new_item)
         db.session.commit()
         return jsonify({'id': new_item.id}), 201
     ```
   - **Lire tous les éléments** :
     ```python
     @app.route('/items', methods=['GET'])
     def get_items():
         items = Item.query.all()
         return jsonify([{'id': item.id, 'name': item.name, 'description': item.description} for item in items])
     ```
   - **Lire un élément par ID** :
     ```python
     @app.route('/items/<int:id>', methods=['GET'])
     def get_item(id):
         item = Item.query.get_or_404(id)
         return jsonify({'id': item.id, 'name': item.name, 'description': item.description})
     ```
   - **Mettre à jour un élément** :
     ```python
     @app.route('/items/<int:id>', methods=['PUT'])
     def update_item(id):
         item = Item.query.get_or_404(id)
         data = request.get_json()
         item.name = data['name']
         item.description = data.get('description')
         db.session.commit()
         return jsonify({'id': item.id})
     ```
   - **Supprimer un élément** :
     ```python
     @app.route('/items/<int:id>', methods=['DELETE'])
     def delete_item(id):
         item = Item.query.get_or_404(id)
         db.session.delete(item)
         db.session.commit()
         return jsonify({'result': 'success'}), 204
     ```

### 6. Lancer l'application
   Vous pouvez maintenant exécuter votre application avec:
   ```bash
   flask run
   ```
   Votre API CRUD est maintenant prête à être utilisée. Vous pouvez tester chaque route avec un outil comme Postman ou cURL.

## Correction
- Assurez-vous que toutes les routes fonctionnent comme prévu.
- Testez chaque opération CRUD pour vérifier qu'elles retournent les bonnes réponses.
- Vérifiez que l'application se connecte correctement à la base de données.

## Conclusion
Dans ce TP, vous avez appris à construire une API REST CRUD complète en utilisant Flask. Vous pouvez maintenant étendre cet exemple pour y ajouter plus de fonctionnalités, comme l'authentification, la pagination, ou encore le filtrage.